<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MCMV Rural</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
<div class="container py-4">
<div class="card shadow p-4 rounded-4">

<h4 class="text-center text-success mb-4">Cadastro MCMV Rural</h4>

<form id="form">

<input class="form-control mb-2" name="nome" placeholder="Nome" 
pattern="[A-Za-z- ]+" title="Somente letras" required>

<input class="form-control mb-2" name="cpf" placeholder="CPF (11 n칰meros)" 
maxlength="11" pattern="\d{11}" title="Digite 11 n칰meros" required>

<button type="button" class="btn btn-outline-primary w-100 mb-3"
onclick="consultarCPF()">游댌 Consultar CPF</button>

<select class="form-select mb-2" name="profissao" id="profissao" required onchange="profOutros()">
<option value="">Selecione Profiss칚o</option>
<option value="Agricultor">Agricultor</option>
<option value="Aposentado">Aposentado</option>
<option value="Outros">Outros</option>
</select>

<input id="prof_outros" class="form-control mb-2" name="prof_outros" 
placeholder="Descreva a profiss칚o" style="display:none">

<input class="form-control mb-2" name="atividade" placeholder="Atividade" required>
<input class="form-control mb-2" name="renda" placeholder="Renda (R$)" type="number" step="0.01" required>

<select class="form-select mb-2" name="estado_civil" id="estado" required onchange="toggleConjuge()">
<option value="">Selecione Estado Civil</option>
<option value="Solteiro">Solteiro</option>
<option value="Casado">Casado</option>
<option value="Uni칚o Est치vel">Uni칚o Est치vel</option>
<option value="Vi칰vo">Vi칰vo</option>
</select>

<select class="form-select mb-2" name="beneficio">
<option value="Nenhum">Nenhum</option>
<option value="BPC">BPC</option>
<option value="Bolsa Fam칤lia">Bolsa Fam칤lia</option>
</select>

<input class="form-control mb-2" name="endereco" placeholder="Endere칞o" required>
<input class="form-control mb-2" name="telefone" placeholder="Telefone" pattern="\d+" required>

<input class="form-control mb-2" name="pcd" placeholder="Quantidade de PCD" pattern="\d*">
<input class="form-control mb-2" name="idosos" placeholder="Quantidade de Idosos" pattern="\d*">
<input class="form-control mb-2" name="criancas" placeholder="Quantidade de Crian칞as" pattern="\d*">
<input class="form-control mb-2" name="moradores" placeholder="Quantidade de Moradores" pattern="\d*">

<!-- C칪njuge -->
<div id="conjuge" style="display:none">
<hr>
<h6>C칪njuge</h6>

<input class="form-control mb-2" name="conjuge_nome" placeholder="Nome" pattern="[A-Za-z- ]+">
<input class="form-control mb-2" name="conjuge_cpf" placeholder="CPF" pattern="\d{11}">
<select class="form-select mb-2" name="conjuge_profissao" id="conjuge_prof" onchange="conjugeOutros()">
<option value="">Selecione Profiss칚o</option>
<option value="Agricultor">Agricultor</option>
<option value="Aposentado">Aposentado</option>
<option value="Outros">Outros</option>
</select>
<input id="conjuge_prof_outros" class="form-control mb-2" name="conjuge_prof_outros"
placeholder="Descreva a profiss칚o" style="display:none">

<input class="form-control mb-2" name="conjuge_atividade" placeholder="Atividade">
<input class="form-control mb-2" name="conjuge_renda" placeholder="Renda (R$)" type="number" step="0.01">
</div>

<div class="d-grid gap-2 mt-3">
<button type="submit" class="btn btn-success">游 Salvar / Atualizar</button>
<button type="reset" class="btn btn-secondary">游빛 Limpar</button>
</div>

</form>
</div>
</div>

<script>
// Mostrar c칪njuge se Casado ou Uni칚o Est치vel
function toggleConjuge(){
    const c = document.getElementById('conjuge');
    const e = document.getElementById('estado').value;
    c.style.display = (e === "Casado" || e === "Uni칚o Est치vel") ? "block" : "none";
}

// Mostrar input "Outros" na profiss칚o do benefici치rio
function profOutros(){
    const p = document.getElementById('profissao').value;
    document.getElementById('prof_outros').style.display = (p === "Outros") ? "block" : "none";
}

// Mostrar input "Outros" na profiss칚o do c칪njuge
function conjugeOutros(){
    const p = document.getElementById('conjuge_prof').value;
    document.getElementById('conjuge_prof_outros').style.display = (p === "Outros") ? "block" : "none";
}

// Consultar CPF
function consultarCPF(){
    const cpf = document.querySelector("[name='cpf']").value;
    if(cpf.length !== 11){ alert("Digite 11 n칰meros do CPF"); return; }
    fetch(`/consultar/${cpf}`).then(r=>r.json()).then(d=>{
        if(d.erro){ alert(d.erro); return; }
        Object.keys(d).forEach(k=>{
            const el = document.querySelector(`[name='${k}']`);
            if(el) el.value = d[k];
        });
        toggleConjuge();
        profOutros();
        conjugeOutros();
    });
}
</script>

</body>
</html>
